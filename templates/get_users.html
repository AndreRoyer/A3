<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Usuários</title>
    <link rel="stylesheet" href="static/style_get_users.css">
    <style>
        #resultado {
          margin-top: 20px;
        }
        .item {
          padding: 10px;
          background-color: #f4f4f4;
          margin-bottom: 5px;
        }
      </style>
</head>
<body>
    <script type="module">
        
        import { app,auth,db  } from './static/firebase.js';
        import { collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    </script>
    <h1>Lista de Itens</h1>
    <table id="users-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Item</th>
            </tr>
        </thead>
        <tbody id="users-body">
            <!-- Os usuários serão adicionados dinamicamente aqui -->
        </tbody>
    </table>
    <form id="cadastrarIten">
       <label for="cadastrar">Cadastrar:</label>
       <input type="text" id="cadastrar" name="cadastrar">
       <button type="submit" onclick="window.location.reload();" >Cadastrar</button><br><br>
    </form>
    <form>
        <h1>Pesquisa de Itens</h1>

        <!-- Campo de pesquisa -->
        <input type="text" id="barraPesquisa" placeholder="Digite o nome do item" oninput="pesquisarItens()" />
        
        <!-- Exibição dos resultados -->
        <div id="resultado"></div>
    </form>

        <div id="resultado"></div>
  
    <p><a href="http://127.0.0.1:5000/">Voltar ao login</a></p>

    <p><a href="http://127.0.0.1:5000/alterar">alterar item</a></p>

    <script src="static/scripts_get_users.js"></script>

    <script> 

    async function pesquisarItens() {
      const nomeItem = document.getElementById("barraPesquisa").value;
      
      if (nomeItem.trim() === "") {
        document.getElementById("resultado").innerHTML = "";  // Limpa os resultados se não houver texto
        return;
      }

      try {
        const response = await fetch(`http://127.0.0.1:5000/buscar?item=${nomeItem}`);
        const data = await response.json();
        
        if (response.ok) {
          mostrarResultados(data);
        } else {
          document.getElementById("resultado").innerHTML = `<p>${data.message}</p>`;
        }
      } catch (error) {
        console.error("Erro ao buscar itens:", error);
        document.getElementById("resultado").innerHTML = "<p style='color: red;'>Erro ao buscar itens.</p>";
      }
    }

    function mostrarResultados(itens) {
      const resultadoDiv = document.getElementById("resultado");
      resultadoDiv.innerHTML = "";  // Limpa resultados anteriores

      if (itens.length === 0) {
        resultadoDiv.innerHTML = "<p>Nenhum item encontrado.</p>";
        return;
      }

      itens.forEach(users => {
        const itemDiv = document.createElement("div");
        itemDiv.classList.add("item");
        itemDiv.innerHTML = `<strong>${users.item}</strong> (ID: ${users.id})`;
        resultadoDiv.appendChild(itemDiv);
      });
    }
    </script>
</body>
</html>
